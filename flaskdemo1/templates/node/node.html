<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <script src="/static/js/echarts.js"></script>
    <script src="/static/js/commonUse.js"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
    <link rel="stylesheet" href="/static/layui/css/layui.css"  media="all">
    <title>charts</title>
</head>
<body class="layui-layout-body">



    <div id="chart" style="width:100%;height: 1200px;">
    </div>



<script type="text/javascript" >
    var mychart=echarts.init(document.getElementById('chart'));
    var option={
        title:{
            text:'图示例'
        },
        tooltip:{
            show:true,
            showContent: true,
            enterable: true,
            formatter:function (a) {
                return nodetip(a);
            }
        },
        animationDurationUpdate:0,
        animationEasingUpdate:'quinticInOut',
        series: [
        {
            type: 'graph',
            layout: 'force',
            symbolSize: 80,
            roam: true,
            animation: false,
            label: {
                color:'black',
                show : true,
                fontSize: $(window).width()*0.012,
                formatter: function (param) {
                    return param.name.replaceAll(' ','\n');
                },

            },
            edgeSymbol: ['none', 'arrow'],
            edgeSymbolSize: [4, 10],
            edgeLabel: {
                normal: {
                    fontSize: 20,
                  show: true,
                  formatter: function(x) {
                    return x.data['label'];
                  }
                }
            },
            force: {
                repulsion: 500, //斥力
                edgeLength: [100, 500], //默认距离
                gravity:0.05,
              },
            draggable: true,
            itemStyle:{
                color: function (data) {
                    return colors(data);
                },
            },
        }
    ]
    }
    mychart.showLoading({
		text: '正在加载中，请耐心等待！',
		color: '#1890ff',
		textColor: '#000',
		maskColor: 'rgba(255, 255, 255, 0.8)',
		zlevel: 0
	});

    mychart.setOption(option);

    //点击事件
    /*mychart.on('click',function (info) {
        console.log(info.data);
        document.getElementById('nid').title=info.data['id'];
        document.getElementById('fkind').title=info.data['label'][0];

        document.getElementById('kind').value=info.data['label'][0];
        document.getElementById('kind').readonly='readonly';

        document.getElementById('name').value=info.data['name'];
        document.getElementById('name').readonly='readonly';

        document.getElementById('age').value=info.data['age'];
        var select = document.getElementById('gender');
        if ('男性'==info.data['sex']){
            select.options[1].selected=true;
            select.options[1].focused=true;
            layui.form.render("select") ;
        }
        else if ('女性'==info.data['sex']) {
            select.options[2].selected=true;
            layui.form.render("select") ;
        }
        else {
            select.options[0].selected=true;
            layui.form.render("select") ;
        }
        document.getElementById('degree').value=info.data['degree'];
        document.getElementById('work').value=info.data['work'];
        document.getElementById('home').value=info.data['home'];

    })*/

    {#// 鼠标拖拽固定#}
    {#mychart.on('mouseup', function (params) {#}
    {#      var option = mychart.getOption();#}
    {#      option.series[0].data[params.dataIndex].x = params.event.offsetX;#}
    {#      option.series[0].data[params.dataIndex].y = params.event.offsetY;#}
    {#      option.series[0].data[params.dataIndex].fixed = true;#}
    {#      //设置文字#}
    {#         option.series[0].label.fontSize = fontSize;#}
    {#         option.series[0].edgeLabel.textStyle.fontSize = fontSize;#}
    {#      mychart.setOption(option);#}
    {#    });#}
{##}
{#     myECharts.on('graphRoam', function(e) {#}
{#    const option = that.echartsGraph.getOption(); // 获得当前option.series的zoom#}
{#    const textPercent = (option.series[0].zoom - 0.8) / 0.8; // 计算比例,我设置zoom的初始值是0.8#}
{#    option.series[0].label.fontSize = 9 + 9 * textPercent // 等比例计算fontSize#}
{#    that.echartsGraph.setOption(option); // setOption#}
{#  });#} 


    $.ajax({
        url:"/user/restext",
        type:"POST",
        dataType:"json",
        success:function (data) {
            {# console.log(data['nodes']);#}
            {#console.log(data['links']);#}
            mychart.hideLoading();
            mychart.setOption({
                series:[{
                    data:data['nodes'],
                    links:data['links'],
                },
                ]
            });



        }
    })
</script>

<script type="text/javascript">
    /*function search() {
        var kind = document.getElementById("kind").value;
        var name = document.getElementById("name").value;
        var age = document.getElementById("age").value;
        var gender = document.getElementById("gender").value;
        var degree = document.getElementById("degree").value;
        var work = document.getElementById("work").value;
        var home = document.getElementById("home").value;
        $.ajax({
            url: "/user/search",
            type:"POST",
            dataType: "json",
            data:{
                kind:kind,
                name:name,
                age:age,
                gender:gender,
                degree:degree,
                work:work,
                home:home,
            },
            success:function (data) {
                {#console.log(data);#}
                if (data['nodes']==0){
                    alert('无数据');
                }
                else {
                    mychart.setOption(option,true);
                    //console.log(data);
                    mychart.setOption({
                        series:[{
                            data:data['nodes'],
                            links:data['links'],
                        },
                        ]
                    });
                    }


            }
        })
    }

    function add() {
        var kind = document.getElementById("kind").value;
        var name = document.getElementById("name").value;
        var age = document.getElementById("age").value;
        var gender = document.getElementById("gender").value;
        var degree = document.getElementById("degree").value;
        var work = document.getElementById("work").value;
        var home = document.getElementById("home").value;

        if (kind==""&&name==""&&age==""&&gender==""&&degree==""&&work==""&&home==""){
            alert("不能全为空");
            return false;
        }

        $.ajax({
            url:"/user/add",
            type:"POST",
            {#dataType:"json",#}
            data:{
                kind:kind,
                name:name,
                age:age,
                gender:gender,
                degree:degree,
                work:work,
                home:home,
            },
            success:function (data) {
                console.log(data);
                if (data=="fail"){
                    alert("已存在节点");
                    //location.replace(document.referrer);
                }
                else {
                    alert("创建成功");
                    //location.replace(document.referrer);
                }
            }
        })
    }

    function del() {

        var kind = document.getElementById("kind").value;
        var name = document.getElementById("name").value;
        var age = document.getElementById("age").value;
        var gender = document.getElementById("gender").value;
        var degree = document.getElementById("degree").value;
        var work = document.getElementById("work").value;
        var home = document.getElementById("home").value;

        $.ajax({
            url:"/user/delete",
            type:"POST",
            {#dataType:"json",#}
            data:{
                kind:kind,
                name:name,
                age:age,
                gender:gender,
                degree:degree,
                work:work,
                home:home,
            },
            success:function (data) {
                console.log(data);
                if (data=="fail"){
                    alert("删除失败");
                    //location.replace(document.referrer);
                }
                else {
                    alert("删除成功");
                    //location.replace(document.referrer);
                }
            }
        })
    }
    
    function uodate() {
        var id = document.getElementById('nid').title;
        var fkind = document.getElementById('fkind').title;
        var kind = document.getElementById("kind").value;
        var name = document.getElementById("name").value;
        var age = document.getElementById("age").value;
        var gender = document.getElementById("gender").value;
        var degree = document.getElementById("degree").value;
        var work = document.getElementById("work").value;
        var home = document.getElementById("home").value;

        if (kind==""||name==""||age==""||gender==""||degree==""||work==""||home==""){
            alert("请完善要修改的信息！");``
            return false;
        }
        $.ajax({
            url:'/user/update',
            type:'POST',
            data:{
                id:id,
                fkind:fkind,
                kind:kind,
                name:name,
                age:age,
                gender:gender,
                degree:degree,
                work:work,
                home:home,
            },
            success:function (data) {
                console.log(data);
                if (data=="fail"){
                    alert("修改失败");
                }
                else {
                    alert("修改成功");
                }
            }
        })

    }

    function reset() {
        document.getElementById("myform").reset();
    }*/

</script>
</body>
</html>