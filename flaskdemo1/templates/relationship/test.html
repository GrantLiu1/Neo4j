<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <script src="/static/js/echarts.js"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
    <script src="/static/ajax/node/addressNode.js"></script>
    <script src="/static/js/commonUse.js"></script>
    <link rel="stylesheet" href="/static/layui/css/layui.css"  media="all">
    <title>PersonRelationship</title>
</head>
<body>

    <form class="layui-form" id="myform"   method="post">
        <div class="layui-form-item">
            <label class="layui-form-label">人名</label>
                <div class="layui-input-inline">
                    <input type="text" id="node1" name="node1"  lay-verify="title" autocomplete="off" placeholder="请输入人名" class="layui-input" >
                </div>

            <label class="layui-form-label">连接线1</label>
            <div class="layui-input-inline">
               <select name="l1" id="l1" lay-verify="required" lay-filter="xmFilter">
                   <option value=""></option>
                   <option value="-">————</option>
                   <option value="<-"><————</option>
               </select>
            </div>

            <label class="layui-form-label">关系名称</label>
            <div class="layui-input-inline">
               <select name="rel" id="rel" lay-verify="required" lay-filter="xmFilter">
                   <option value=""></option>
               </select>
            </div>

            <label class="layui-form-label">连接线2</label>
            <div class="layui-input-inline">
               <select name="l2" id="l2" lay-verify="required" lay-filter="xmFilter">
                   <option value=""></option>
                   <option value="-">————</option>
                   <option value="->">————></option>
               </select>
            </div>

            <label class="layui-form-label">节点类型</label>
            <div class="layui-input-inline">
               <select name="nodtype" id="nodtype" lay-verify="required" lay-filter="xmFilter">
                   <option value=""></option>
               </select>
            </div>


            <label class="layui-form-label">节点二名称</label>
                <div class="layui-input-inline">
                    <input type="text" id="node2" name="node1"  lay-verify="title" autocomplete="off" placeholder="请输入名称" class="layui-input" >
                </div>
        </div>

        <input type="button" class="layui-btn" value="搜索" onclick="search()">
        <input type="button" class="layui-btn" value="添加" onclick="add()">
        <input type="button" class="layui-btn" value="修改" onclick="update()">
        <input type="button" class="layui-btn" value="删除" onclick="del()">
        <input type="button" class="layui-btn" value="重置" onclick="reset()">
    </form>


        <div id="chart" style="width:100%;height: 1200px;">
    </div>

    <label id="nid" title=""></label>

    <script src="/static/layui/layui.js"></script>
    <script>
        layui.use(['form'],function () {
        var form=layui.form;
        (function b(data,data1){
            var selectEle = document.getElementById('rel');
            var selectNode = document.getElementById('nodtype');


            for (var x in data) {
                var optionObj = document.createElement("option");
                optionObj.value = data[x].toString();
                optionObj.innerHTML = data[x].toString();
                selectEle.appendChild(optionObj);
            }

            for (var x in data1) {
                var optionObj = document.createElement("option");
                optionObj.value = data1[x].toString();
                optionObj.innerHTML = data1[x].toString();
                selectNode.appendChild(optionObj);
            }

        })({{ relName|tojson|safe }},{{ nodeType|tojson|safe }})


        form.render();
        });
    </script>

    <script type="text/javascript" >
    var mychart=echarts.init(document.getElementById('chart'));
    var option={
        title:{
            text:'PersonRelationship'
        },
        tooltip:{
            show:true,
            showContent: true,
            enterable: true,
            formatter:function (params) {
                return nodetip(params);
            }
        },
        animationDurationUpdate:0,
        animationEasingUpdate:'quinticInOut',
        series: [
        {
            type: 'graph',
            layout: 'force',
            symbolSize: 80,
            roam: true,
            nodeScaleRatio : 0,
            animation: false,
            label: {
                color:'black',
                show : true,
                fontSize: $(window).width()*0.012,
                formatter: function (param) {
                    return param.name.replaceAll(' ','\n');
                },
            },
            edgeSymbol: ['none', 'arrow'],
            edgeSymbolSize: 6,
            edgeLabel: {
                normal: {
                    fontSize: 20,
                    show: true,
                    formatter: function(x) {
                        return x.data['label'];
                    }
                }
            },
            force: {
                repulsion: 500, //斥力
                edgeLength: 500, //默认距离
                gravity:0.03,
                layoutAnimation : true
              },
            draggable: true,
            itemStyle:{
                color:function (a) {
                     return colors(a);
                },
            },
        }
    ]
    }
    mychart.showLoading({
		text: '正在加载中，请耐心等待！',
		color: '#1890ff',
		textColor: '#000',
		maskColor: 'rgba(255, 255, 255, 0.8)',
		//zlevel: 0
	});

    mychart.setOption(option);

    //点击事件
    mychart.on('click',function (info) {
        console.log(info.data);
        document.getElementById('nid').title=info.data['id'];
        document.getElementById('name').value=info.data['name'];


    })



    $.ajax({
        //url:"/node/arestext",
        url:"/general/relRes/person",
        type:"get",
        dataType:"json",
        success:function (data) {
            console.log(data);
            mychart.hideLoading();
            mychart.setOption({
                series:[{
                    data:data['nodes'],
                    links:data['links'],
                },
                ]
            });
        }
    })
</script>
</body>
</html>