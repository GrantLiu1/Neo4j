<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <script src="/static/js/echarts.js"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
    <script src="/static/ajax/relationship/psersonRelationship.js"></script>
    <script src="/static/js/commonUse.js"></script>
    <script src="/static/layui/layui.js"></script>
    <link rel="stylesheet" href="/static/layui/css/layui.css"  media="all">

    <title>Relationship</title>
</head>
<body>

    <form class="layui-form" id="myform"   method="post">
        <div class="layui-form-item">
            <label class="layui-form-label">节点一类型</label>
                <div class="layui-input-inline">
                   <select name="nod1type" id="nod1type" >
                       <option value=""></option>
                   </select>
                </div>

            <label class="layui-form-label">节点一id</label>
                <div class="layui-input-inline">
                    <input type="text" id="id1" name="id1" disabled="disabled" lay-verify="title" autocomplete="off" placeholder="请选择节点一" class="layui-input" >
                </div>
                <div class="layui-input-inline">
                    <button class="layui-btn layui-btn-normal" type="button" lay-submit lay-filter="saveBtn">选择</button>
                 </div>


            <label class="layui-form-label">连接线1</label>
            <div class="layui-input-inline">
               <select name="l1" id="l1"  required="required">
                   <option value=""></option>
                   <option value="-">————</option>
                   <option value="<-"><————</option>
               </select>
            </div>

            <label class="layui-form-label">关系名称</label>
            <div class="layui-input-inline">
               <select name="rel" id="rel" >
                   <option value=""></option>
               </select>
            </div>

            <label class="layui-form-label">连接线2</label>
            <div class="layui-input-inline">
               <select name="l2" id="l2" required="required">
                   <option value=""></option>
                   <option value="-">————</option>
                   <option value="->">————></option>
               </select>
            </div>

            <label class="layui-form-label">节点二类型</label>
            <div class="layui-input-inline">
               <select name="nod2type" id="nod2type" required="required">
                   <option value=""></option>
               </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">节点二id</label>
                <div class="layui-input-inline">
                    <input type="text" id="id2" name="id2" disabled="disabled"  lay-verify="title" autocomplete="off" placeholder="请选择节点二" class="layui-input" >
                </div>
            <button class="layui-btn layui-btn-normal" type="button" lay-submit lay-filter="saveBtn">选择</button>
        </div>

        <input type="button" class="layui-btn" value="搜索" onclick="search()">
        <input type="button" class="layui-btn" value="添加" onclick="add()">
        <input type="button" class="layui-btn" value="删除" onclick="del()">
        <input type="button" class="layui-btn" value="重置" onclick="reset()">
    </form>


        <div id="chart" style="width:100%;height: 1200px;">
    </div>

    <label id="nid" title=""></label>


    <script>

        layui.use(['form'],function () {
        var form=layui.form,
            $ = layui.jquery,
            layer = layui.layer;

        (function b(data,data1){
            var selectEle = document.getElementById('rel');
            var selectNode1 = document.getElementById('nod1type');
            var selectNode2 = document.getElementById('nod2type');


            for (var x in data) {
                var optionObj = document.createElement("option");
                optionObj.value = data[x].toString();
                optionObj.innerHTML = data[x].toString();
                selectEle.appendChild(optionObj);
            }

            for (var x in data1) {
                var dat=data1[x].toString()

                var optionObj = document.createElement("option");
                if ('province'==dat||'city'==dat||'area'==dat)
                    continue;
                optionObj.value = dat;
                optionObj.innerHTML = dat;
                selectNode1.appendChild(optionObj);

                optionObj = document.createElement("option");
                optionObj.value = dat;
                optionObj.innerHTML = dat;
                selectNode2.appendChild(optionObj);
            }

        })({{ relName|tojson|safe }},{{ nodeType|tojson|safe }})
            form.render();

        });

        layui.use(['layedit', 'form', 'layer', 'upload'], function () {
        var form = layui.form,
            $ = layui.jquery,
            layer = layui.layer;

        //监听提交
        form.on('submit(saveBtn)', function (data) {
            var nod1=document.getElementById('nod1type').value;
            var nod2=document.getElementById('nod2type').value;
            var id1=document.getElementById('id1').value;
            if (nod1==''){
                layer.msg('请选择节点一的类型',{icon:5});
                return false;
            }
            if (id1==''){
                var index = layer.open({
                    title: '选择节点',
                    type: 2,
                    shade: 0.2,
                    {#maxmin: true,#}
                    shadeClose: true,
                    area: ['70%', '60%'],
                    content: 'select'+nod1
                });
            }
            else {
                if (nod1!=''&&nod2==''){
                    layer.msg('请选择节点2的类型',{icon:5});
                    return false;
                }
                var index = layer.open({
                    title: '选择节点',
                    type: 2,
                    shade: 0.2,
                    {#maxmin: true,#}
                    shadeClose: true,
                    area: ['70%', '60%'],
                    content: 'select'+nod2
                });
            }

            $(window).on("resize", function () {
                layer.full(index);
            });
        });


        });
        //注意重点是这里 将来这里是要被子层调用的
        function ChooseValues(v) {
            var $ = layui.jquery;
            //监听提交
            if (v != "") {
                if ($("#id1").val()=='')
                    $("#id1").val(v); //这里是向一个ID里赋值
                else
                    $("#id2").val(v);
                //return v;
            }
        }


    </script>

    <script type="text/javascript" >
    var mychart=echarts.init(document.getElementById('chart'));
    var option={
        title:{
            text:'Relationship'
        },
        tooltip:{
            show:true,
            showContent: true,
            enterable: true,
            formatter:function (params) {
                return nodetip(params);
            }
        },
        animationDurationUpdate:0,
        animationEasingUpdate:'quinticInOut',
        series: [
        {
            type: 'graph',
            layout: 'force',
            symbolSize: 80,
            roam: true,
            nodeScaleRatio : 0,
            animation: false,
            label: {
                color:'black',
                show : true,
                fontSize: $(window).width()*0.012,
                formatter: function (param) {
                    return param.name.replaceAll(' ','\n');
                },
            },
            labelLayout:{
                hideOverlap: true
            },
            edgeSymbol: ['none', 'arrow'],
            edgeSymbolSize: 6,
            edgeLabel: {
                normal: {
                    fontSize: 20,
                    show: true,
                    formatter: function(x) {
                        return x.data['label'];
                    }
                }
            },
            force: {
                repulsion: 500, //斥力
                edgeLength: 500, //默认距离
                gravity:0.03,
                layoutAnimation : true
              },
            draggable: true,
            itemStyle:{
                color:function (a) {
                     return colors(a);
                },
            },
        }
    ]
    }
    mychart.showLoading({
		text: '正在加载中，请耐心等待！',
		color: '#1890ff',
		textColor: '#000',
		maskColor: 'rgba(255, 255, 255, 0.8)',
		//zlevel: 0
	});

    mychart.setOption(option);

    //点击事件
    mychart.on('click',function (info) {
        {#document.getElementById('nid').value=info.data['id'];#}
        {#console.log('person' == info.data['label']);#}
        {#for (var datumKey in info.data['label']) {#}
        {#    if ('person' == info.data['label'][datumKey]){#}
        {#        document.getElementById('node1').value=info.data['name'];#}
        {#        document.getElementById('age').value=info.data['age'];#}
        {#        var select = document.getElementById('sex');#}
        {#        if ('男性'==info.data['sex']){#}
        {#            select.options[1].selected=true;#}
        {#            select.options[1].focused=true;#}
        {#            layui.form.render("select") ;#}
        {#        }#}
        {#        else if ('女性'==info.data['sex']) {#}
        {#            select.options[2].selected=true;#}
        {#            layui.form.render("select") ;#}
        {#        }#}
        {#        else {#}
        {#            select.options[0].selected=true;#}
        {#            layui.form.render("select") ;#}
        {#        }#}
        {#        return;#}
        {#    }#}
        {#}#}
        {#document.getElementById('node2').value=info['name'];#}



    })

    $.ajax({
        url:"/user/restext",
        type:"get",
        dataType:"json",
        success:function (data) {
            console.log(data);
            mychart.hideLoading();
            mychart.setOption({
                series:[{
                    data:data['nodes'],
                    links:data['links'],
                },
                ]
            });
        }
    })
</script>
</body>
</html>